\subsection{Tasmeea Verification Algorithm}

\begin{algorithm}[H]
\caption{Tasmeea Algorithm (Implementationâ€‘Aligned Summary)}
\label{alg:tasmeea}
\begin{algorithmic}[1]
\REQUIRE $text\_segments = [s_1, \dots, s_n]$, $sura\_idx$, $overlap\_words$, $window\_words$, $acceptance\_ratio$, and flags for special phrases
\ENSURE List of tuples $(match, ratio)$ per segment

\STATE $aya \leftarrow$ Aya($sura\_idx$)
\STATE $penalty \leftarrow 0$
\FOR{each segment $s_i$ in $text\_segments$}
    \STATE $norm\_text \leftarrow$ normalize($s_i$) \COMMENT{remove spaces/diacritics}
    \STATE $(min\_win, max\_win) \leftarrow estimate\_window\_len(norm\_text, window\_words)$
    \STATE $overlap \leftarrow overlap\_words$
    \STATE $start\_range \leftarrow [-(overlap+penalty),\; overlap + \max(window\_words - overlap,\; max\_win) + penalty]$

    \IF{first segment \AND include\_istiaatha}
        \STATE check istiaatha special case
    \ELSIF{last segment \AND include\_sadaka}
        \STATE check sadaka special case
    \ENDIF

    \STATE $best\_ratio \leftarrow 0$, $best\_match \leftarrow \text{null}$
    \FOR{each start position $p$ in $start\_range$}
        \FOR{each window size $w \in [min\_win, max\_win]$}
            \STATE $c \leftarrow aya.get\_by\_imlaey\_words(p, w)$
            \STATE $ratio \leftarrow 1 - \min(edit\_distance(norm\_text, c), |norm\_text|)/|norm\_text|$
            \IF{$ratio > best\_ratio$ \OR ($ratio = best\_ratio$ \AND $|p| < |best\_start|$)}
                \STATE update $best\_ratio$, $best\_match$, $best\_start$, $best\_window$
            \ENDIF
        \ENDFOR
    \ENDFOR

    \IF{$best\_ratio < acceptance\_ratio$}
        \STATE output $(null, best\_ratio)$
        \STATE $penalty \leftarrow max\_win$
        \STATE $aya \leftarrow aya.step\_by\_imlaey\_words(-overlap, \frac{min\_win+max\_win}{2})$
    \ELSE
        \STATE output $(best\_match, best\_ratio)$
        \STATE $aya \leftarrow aya.step\_by\_imlaey\_words(best\_start, best\_window)$
        \STATE $penalty \leftarrow 0$
    \ENDIF
\ENDFOR
\STATE \textbf{Complexity:} $O(N \cdot W \cdot L^2)$ \COMMENT{$N$=segments, $W$=window range, $L$=segment length}
\end{algorithmic}
\end{algorithm}
